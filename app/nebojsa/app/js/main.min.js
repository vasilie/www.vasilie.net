function start(){start1=performance.now(),loop=window.requestAnimationFrame(start),counter%gameSpeed==0&&game(),counter++}function game(){update(),render()}function update(){bgpos-=speed,-width>=bgpos&&(bgpos=0);for(i in enemies)for(j in bullets)collision(enemies[i],bullets[j])&&enemies.splice(i,1);for(i in enemies)enemies[i].x<player.x?enemies[i].x+=enemies[i].speed*Math.abs(Math.cos(findEnemyMovingAngle(enemies[i],player))):enemies[i].x>player.x+player.width&&(enemies[i].x-=enemies[i].speed*Math.abs(Math.cos(findEnemyMovingAngle(enemies[i],player)))),enemies[i].y<player.y?enemies[i].y+=enemies[i].speed*Math.abs(Math.sin(findEnemyMovingAngle(enemies[i],player))):enemies[i].y>player.y+player.height&&(enemies[i].y-=enemies[i].speed*Math.abs(Math.sin(findEnemyMovingAngle(enemies[i],player)))),enemies[i].x<-510&&enemies.splice(i,1);counter%50==0&&enemies.push(new enemy);for(i in bullets)vB=22,vBx=vB*Math.cos(bullets[i].angle),vBy=vB*Math.sin(bullets[i].angle),bullets[i].x+=vBx*bullets[i].directionX,bullets[i].y+=vBy*bullets[i].directionY,(bullets[i].x>=width||bullets[i].x<=0)&&(bullets[i].directionX*=-1),(bullets[i].y<=25||bullets[i].y>=height-53)&&(bullets[i].directionY*=-1);(keys[37]||keys[65]&&!gameIsOver)&&(player.x-=5,findMouseAngle()),(keys[39]||keys[68]&&!gameIsOver)&&(player.x+=5,findMouseAngle()),(keys[38]||keys[87]&&!gameIsOver)&&(player.y-=5,findMouseAngle()),(keys[40]||keys[83]&&!gameIsOver)&&(player.y+=5,findMouseAngle()),player.x<0&&(player.x=0),player.y<=25&&(player.y=25),player.x>=width-player.width&&(player.x=width-player.width),player.y>=height-player.height-50&&(player.y=height-player.height-50)}function render(){context.clearRect(0,0,width,height),context.fillStyle="black",context.fillRect(0,0,width,25),context.fillStyle="purple",context.fillRect(player.x,player.y,player.width,player.height),context.save(),context.translate(player.x,player.y),context.rotate(player.hand.rotation*Math.PI/180),context.fillStyle="red",context.globalAlpha=.1,context.fillRect(0,-1,2500,1),context.fillRect(0,1,2500,1),context.globalAlpha=.5,context.fillRect(0,0,2500,1),context.globalAlpha=1,context.fillStyle="cyan",context.fillRect(0,0,50,4),context.fillStyle="black",context.restore(),context.fillStyle="black",context.fillRect(0,height-50,width,50);for(i in enemies){var e=enemies[i];context.fillStyle=e.color,context.fillRect(e.x,e.y,e.width,e.height)}context.fillStyle="white";for(i in bullets){var t=bullets[i];context.fillRect(t.x,t.y,t.width,t.height)}context.fillStyle="purple"}function initImages(e){requiredImages=e.length;for(i in e){console.log(e[i]);var t=new Image;t.src="/image/"+e[i],images[i]=t,images[i].onload=function(){doneImages++,console.log(doneImages)}}}function findMouseAngle(){deltaX=mouseX-player.x,deltaY=mouseY-player.y,player.hand.rotation=180/Math.PI*Math.atan2(deltaY,deltaX),console.log("searching")}function findEnemyMovingAngle(e,t){var i=e.x-t.x,n=e.y-t.y,l=180/Math.PI*Math.atan2(n,i);return l}function shoot(){bullets.push(new bullet(player.x,player.y))}function collision(e,t){return!(e.x>t.x+t.width||e.x+e.width<t.x||e.y>t.y+t.height||e.y+e.height<t.y)}function hCollision(e,t){return!(e.x>t.x+t.width||e.x+e.width<t.x)}function vCollision(e,t){return!(e.y>t.y+t.height||e.y+e.height<t.y)}var canvas=document.getElementById("context"),context=canvas.getContext("2d"),width=window.innerWidth-200,height=window.innerHeight-300;canvas.width=width,canvas.height=height,canvas.style.width=canvas.width+"px",canvas.style.height=canvas.height+"px",window.addEventListener("keydown",function(e){keys[e.keyCode]=!0},!1),window.addEventListener("keyup",function(e){delete keys[e.keyCode]},!1),window.addEventListener("mousemove",function(e){mouseX=event.clientX-document.getElementById("context").offsetLeft,mouseY=event.clientY-document.getElementById("context").offsetTop,findMouseAngle()},!1),window.addEventListener("click",function(e){shoot(),console.log(bullets)},!1);var loop,counter=0,gameIsOver=!1,enemies=[],bullets=[],gameSpeed=1,keys=[],bgpos=0,deltaX=1,deltaY=1,speed=5,images=[],requiredImages=0,mouseX,mouseY,doneImages=0,vB,vBx,vBy,player={width:20,height:20,y:100,x:50,hand:{rotation:0}},enemy=function(){this.x=width+100*Math.random(),this.y=25+50*Math.floor(12*Math.random()),this.width=24,this.height=24,this.color="#FF9800",this.speed=3},bullet=function(e,t){this.x=e,this.y=t,this.width=3,this.height=3,this.angle=player.hand.rotation*Math.PI/180,this.deltaX=deltaX,this.rikoshet=0,this.directionX=1,this.directionY=1,this.vBx=1,this.vby=1},start1;findMouseAngle(),start();