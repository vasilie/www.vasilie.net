function start(){start1=performance.now(),loop=window.requestAnimationFrame(start),counter%gameSpeed==0&&game(),counter++}function game(){update(),render()}function update(){bgpos-=speed,-width>=bgpos&&(bgpos=0);for(i in enemies)for(j in bullets)collision(enemies[i],bullets[j])&&(enemies.splice(i,1),score++,$(".score").html(score));for(i in enemies)enemies[i].x<player.x?enemies[i].x+=enemies[i].speed*Math.abs(Math.cos(findEnemyMovingAngle(enemies[i],player))):enemies[i].x>player.x+player.width&&(enemies[i].x-=enemies[i].speed*Math.abs(Math.cos(findEnemyMovingAngle(enemies[i],player)))),enemies[i].y<player.y?enemies[i].y+=enemies[i].speed*Math.abs(Math.sin(findEnemyMovingAngle(enemies[i],player))):enemies[i].y>player.y+player.height&&(enemies[i].y-=enemies[i].speed*Math.abs(Math.sin(findEnemyMovingAngle(enemies[i],player)))),enemies[i].x<-510&&enemies.splice(i,1);counter%50==0&&enemies.push(new enemy);for(i in enemies)collision(enemies[i],player)&&(enemies.splice(i,1),player.health-=25,player.health<=0&&(player.health=0,gameOver()));for(i in bullets)vB=22,vBx=vB*Math.cos(bullets[i].angle),vBy=vB*Math.sin(bullets[i].angle),bullets[i].x+=vBx*bullets[i].directionX,bullets[i].y+=vBy*bullets[i].directionY,(bullets[i].x>=width||bullets[i].x<=0)&&(bullets[i].directionX*=-1,bullets[i].decay-=1,bullets[i].decay<=0&&bullets.splice(i,1)),(bullets[i].y<=25||bullets[i].y>=height-53)&&(bullets[i].directionY*=-1,bullets[i].decay-=1,bullets[i].decay<=0&&bullets.splice(i,1));(keys[37]||keys[65]&&!gameIsOver)&&(player.x-=5,findMouseAngle()),(keys[39]||keys[68]&&!gameIsOver)&&(player.x+=5,findMouseAngle()),(keys[38]||keys[87]&&!gameIsOver)&&(player.y-=5,findMouseAngle()),(keys[40]||keys[83]&&!gameIsOver)&&(player.y+=5,findMouseAngle()),keys[13]&&gameIsOver&&newGame(),player.x<0&&(player.x=0),player.y<=25&&(player.y=25),player.x>=width-player.width&&(player.x=width-player.width),player.y>=height-player.height-50&&(player.y=height-player.height-50)}function render(){context.clearRect(0,0,width,height),context.fillStyle="black",context.fillRect(0,0,width,25),context.fillText("Score",10,50),context.fillStyle="red",context.fillRect(5,10,200,5),context.fillStyle=player.color,context.fillRect(5,10,2*player.health,5),context.fillStyle="white",context.fillText(player.health+"%",210,16),context.fillStyle=player.color,context.fillRect(player.x,player.y,player.width,player.height),context.save(),context.translate(player.x,player.y),context.rotate(player.hand.rotation*Math.PI/180),context.fillStyle="red",context.globalAlpha=.1,context.fillRect(0,-1,2500,1),context.fillRect(0,1,2500,1),context.globalAlpha=.5,context.fillRect(0,0,2500,1),context.globalAlpha=1,context.fillStyle="cyan",context.fillRect(0,0,50,4),context.fillStyle="black",context.restore(),context.fillStyle="black",context.fillRect(0,height-50,width,50);for(i in enemies){var e=enemies[i];context.fillStyle=e.color,context.fillRect(e.x,e.y,e.width,e.height)}context.fillStyle="white";for(i in bullets){var t=bullets[i];context.fillRect(t.x,t.y,t.width,t.height)}context.fillStyle="purple",gameIsOver&&(context.fillStyle="white",context.font="50px Press",context.fillText("GAME OVER",width/2-220,height/2+25),context.font="15px Press",context.fillText("YOUR SCORE: "+score,width/2-220,height/2+50),context.font="12px Press",context.fillText("PRESS ENTER FOR NEW GAME",width/2-220,height/2+100),context.font="10px sans-serif"),context.fillStyle=player.color,context.fillRect(mouseX-10,mouseY,21,1),context.fillRect(mouseX,mouseY-10,1,21)}function initImages(e){requiredImages=e.length;for(i in e){console.log(e[i]);var t=new Image;t.src="/image/"+e[i],images[i]=t,images[i].onload=function(){doneImages++,console.log(doneImages)}}}function findMouseAngle(){deltaX=mouseX-player.x,deltaY=mouseY-player.y,player.hand.rotation=180/Math.PI*Math.atan2(deltaY,deltaX),console.log("searching")}function findEnemyMovingAngle(e,t){var i=e.x-t.x,l=e.y-t.y,n=180/Math.PI*Math.atan2(l,i);return n}function shoot(){!gameIsOver&&bullets.length<10&&(bullets.push(new bullet(player.x,player.y)),sound_shoot[sound_shoot_counter].play(),sound_shoot_counter++,sound_shoot_counter%=10)}function collision(e,t){return!(e.x>t.x+t.width||e.x+e.width<t.x||e.y>t.y+t.height||e.y+e.height<t.y)}function hCollision(e,t){return!(e.x>t.x+t.width||e.x+e.width<t.x)}function vCollision(e,t){return!(e.y>t.y+t.height||e.y+e.height<t.y)}function gameOver(){gameIsOver=!0}function newGame(){bullets=[],enemies=[],player.health=100,gameIsOver=!1,player.x=50,player.y=100}var canvas=document.getElementById("context"),context=canvas.getContext("2d"),width=window.innerWidth-200,height=window.innerHeight-300;canvas.width=width,canvas.height=height,canvas.style.width=canvas.width+"px",canvas.style.height=canvas.height+"px";var score=0,gameIsOver=!1;window.addEventListener("keydown",function(e){keys[e.keyCode]=!0},!1),window.addEventListener("keyup",function(e){delete keys[e.keyCode]},!1),window.addEventListener("mousemove",function(e){mouseX=event.clientX-document.getElementById("context").offsetLeft,mouseY=event.clientY-document.getElementById("context").offsetTop,findMouseAngle()},!1),window.addEventListener("click",function(e){shoot(),console.log(bullets)},!1);var loop,counter=0,gameIsOver=!1,enemies=[],bullets=[],gameSpeed=1,keys=[],bgpos=0,deltaX=1,deltaY=1,speed=5,images=[],requiredImages=0,mouseX,mouseY,doneImages=0,vB,vBx,vBy,player={width:20,height:20,y:100,x:50,health:100,color:"rgb("+Math.floor(255*Math.random())+","+Math.floor(255*Math.random())+","+Math.floor(255*Math.random())+")",hand:{rotation:0}};$("#context").css({"border-color":player.color});var enemy=function(){this.x=width+100*Math.random(),this.y=25+50*Math.floor(12*Math.random()),this.width=24,this.height=24,this.color="rgb("+Math.floor(255*Math.random())+","+Math.floor(255*Math.random())+","+Math.floor(255*Math.random())+")",this.speed=3},sound_shoot=[],sound_shoot_counter=0;for(i=0;i<12;i++)sound_shoot.push(new Audio("sound/shoot.wav")),sound_shoot[i].volume=.05;var bullet=function(e,t){this.x=e,this.y=t,this.width=3,this.height=3,this.angle=player.hand.rotation*Math.PI/180,this.deltaX=deltaX,this.rikoshet=0,this.directionX=1,this.directionY=1,this.vBx=1,this.vby=1,this.decay=4},start1;findMouseAngle(),start();